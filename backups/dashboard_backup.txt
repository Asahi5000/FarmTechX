<?php
require '../authenticator.php';
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FarmTechX Admin Dashboard</title>
    <link rel="stylesheet" href="../assets/css/styles.css" />
    <link rel="stylesheet" href="../assets/css/sensors.css" />
    <link rel="stylesheet" href="../assets/css/switch.css" />
    <link rel="icon" href="../assets/images/FarmTechX.jpg" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>


<body>
    <div class="main-container">
      <?php include '../assets/php/hamburder-menu.php'; ?>      
      <?php include '../assets/php/sidebar-dashboard.php'; ?>
        
      <main class="main-content">
            
        <div class="content-wrapper">
          <?php include '../assets/php/welcome-card-dashboard.php'; ?>
                
          <section>
            <h2 class="sensors-title">Sensors</h2>
                    
            
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

            <div class="cards">
              <div class="card">ðŸŒ¡ Water Temperature: <span id="tempValue">--</span></div>
              <div class="card">ðŸ’§ Electric Conductivity(EC): <span id="ecValue">--</span></div>
              <div class="card">ðŸ§ª Potential Hydrogen(pH): <span id="phValue">--</span></div>
              <div class="card"><span id="lastUpdate">Updated: --</span></div>
            </div>

            <div class="Graph-title">
              <h2>Sensors Graph</h2>
            </div>

            <canvas id="sensorChart"></canvas>
              <div class="plot-section">
                <h3 class="plot-title">Probe 1</h3>
                <h4 class="soil-tester-title">Soil Reading</h4>
              <div class="sensor-grid">
                  
              <div class="sensor-card">
                <div class="sensor-value">--</div>
                <div class="sensor-label">EC Meter</div>
              </div>

              <div class="sensor-card">
                <div class="sensor-value">--</div>
                <div class="sensor-label">pH Meter</div>
              </div>
                
              <div class="sensor-card">
                <div class="sensor-value">--</div>
                <div class="sensor-label">Soil Moisture</div>
              </div>
              </div>
                        
              <button class="add-plot-btn">Add Probe</button>
            </div>
          </section>



      <section>
        <h2 class="sensors-title">Water Pump Control</h2>

    <!-- Switch Title -->
    <div class="switch-title" id="switchTitle">Currently: Manual Mode</div>

    <!-- Mode Switch -->
    <div class="mode-switch">
      <label class="switch">
        <input type="checkbox" id="modeToggle">
        <span class="slider"></span>
      </label>
    </div>

    <!-- Manual Mode -->
    <div class="section" id="manualMode">
      <h2>Manual Mode</h2>
      <div class="valves-grid">
        <script>
          for(let i=1;i<=16;i++){
            document.write(`<div class="valve" onclick="toggleValve(this)">Valve ${i} <span class="indicator"></span></div>`);
          }
        </script>
      </div>

      <!-- pH Adjustment Manual -->
      <div class="ph-control">
        <label>Adjust pH Level (Manual):</label>
        <input 
          type="range" 
          id="phManual" 
          min="1" 
          max="14" 
          value="7.0" 
          step="0.1" 
          oninput="document.getElementById('phManualValue').innerText=parseFloat(this.value).toFixed(1)">
        <div>Current pH: <span id="phManualValue" class="ph-value">7.0</span></div>
      </div>
    </div>

    <!-- Automation Mode -->
    <div class="section" id="automationMode" style="display:none;">
      <h2>Automation Mode</h2>
      <form class="automation-form" id="scheduleForm">
        <label for="valve">Select Valve:</label>
        <select id="valve" required>
          <option value="">--Choose Valve--</option>
          <script>
            for(let i=1;i<=16;i++){
              document.write(`<option value="Valve ${i}">Valve ${i}</option>`);
            }
          </script>
        </select>

        <label for="time">Select Time:</label>
        <input type="time" id="time" required>

        <label for="duration">Duration (minutes):</label>
        <input type="number" id="duration" min="1" max="120" step="1" value="10">

        <!-- pH Automation -->
        <label for="phAuto">Set pH Level:</label>
        <input type="number" id="phAuto" min="1" max="14" step="0.1" value="7.0">

        <button type="submit">Add Schedule</button>
      </form>

      <!-- Schedule List -->
      <table id="scheduleTable">
        <thead>
          <tr>
            <th>Valve</th>
            <th>Time</th>
            <th>Duration</th>
            <th>pH Level</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
      </section>

        </div>
        
      </main>
      
    </div>





<script src="../assets/script/dashboardSwitch.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../assets/script/fetchDashboardSensors.js"></script>

<script src="../assets/script/activeLink.js"></script>
<script src="../assets/script/navClicks.js"></script>
<script src="../assets/script/closeSidebar.js"></script>
<script src="../assets/script/toggleSidebar.js"></script>
<script src="../assets/script/addPlot.js"></script>
<script src="../assets/script/preventCache.js"></script>

</body>
</html>